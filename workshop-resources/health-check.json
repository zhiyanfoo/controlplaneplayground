{
  "server_address": "localhost:18000",
  "resources": [
    {
      "type_url": "type.googleapis.com/envoy.config.listener.v3.Listener",
      "name": "health_check_listener",
      "data": {
        "name": "health_check_listener",
        "address": {
          "socket_address": {
            "protocol": "TCP",
            "address": "0.0.0.0",
            "port_value": 10002
          }
        },
        "filter_chains": [
          {
            "filters": [
              {
                "name": "http-connection-manager",
                "typed_config": {
                  "@type": "type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager",
                  "codec_type": "AUTO",
                  "stat_prefix": "health_check",
                  "rds": {
                    "config_source": {
                      "ads": {},
                      "resource_api_version": "V3",
                      "initial_fetch_timeout": "1s"
                    },
                    "route_config_name": "health_check_route"
                  },
                  "http_filters": [
                    {
                      "name": "http-router",
                      "typed_config": {
                        "@type": "type.googleapis.com/envoy.extensions.filters.http.router.v3.Router"
                      }
                    }
                  ],
                  "access_log": [
                    {
                      "name": "envoy.access_loggers.file",
                      "typed_config": {
                        "@type": "type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog",
                        "path": "/dev/stdout",
                        "log_format": {
                          "text_format_source": {
                            "inline_string": "[%START_TIME%] \"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\" %RESPONSE_CODE% %RESPONSE_FLAGS% %GRPC_STATUS%(%GRPC_STATUS_NUMBER%) %BYTES_SENT% %DURATION% %UPSTREAM_HOST% %UPSTREAM_CLUSTER% OUTLIER_STATUS %UPSTREAM_LOCAL_ADDRESS_WITHOUT_PORT%\n"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        ]
      }
    },
    {
      "type_url": "type.googleapis.com/envoy.config.route.v3.RouteConfiguration",
      "name": "health_check_route",
      "data": {
        "name": "health_check_route",
        "virtual_hosts": [
          {
            "name": "health_check_vhost",
            "domains": ["localhost:10002", "*"],
            "routes": [
              {
                "match": {
                  "prefix": "/"
                },
                "route": {
                  "cluster": "health_check_cluster"
                }
              }
            ]
          }
        ]
      }
    },
    {
      "type_url": "type.googleapis.com/envoy.config.cluster.v3.Cluster",
      "name": "health_check_cluster",
      "wildcard_node_update": true,
      "data": {
        "name": "health_check_cluster",
        "connect_timeout": "5s",
        "type": "EDS",
        "eds_cluster_config": {
          "eds_config": {
            "ads": {},
            "resource_api_version": "V3",
            "initial_fetch_timeout": "1s"
          }
        },
        "lb_policy": "ROUND_ROBIN",
        "typed_extension_protocol_options": {
          "envoy.extensions.upstreams.http.v3.HttpProtocolOptions": {
            "@type": "type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions",
            "explicit_http_config": {
              "http2_protocol_options": {}
            }
          }
        },
        "health_checks": [
          {
            "timeout": "1s",
            "interval": "5s",
            "interval_jitter": "1s",
            "unhealthy_threshold": 3,
            "healthy_threshold": 2,
            "grpc_health_check": {
                "service_name": "test-server"
            }
          }
        ],
        "outlier_detection": {
          "consecutive_5xx": 2,
          "consecutive_local_origin_failure": 2,
          "interval": "10s",
          "base_ejection_time": "30s",
          "max_ejection_percent": 50
        }
      }
    },
    {
      "type_url": "type.googleapis.com/envoy.config.endpoint.v3.ClusterLoadAssignment",
      "name": "health_check_cluster",
      "data": {
        "cluster_name": "health_check_cluster",
        "endpoints": [
          {
            "lb_endpoints": [
              {
                "endpoint": {
                  "address": {
                    "socket_address": {
                      "protocol": "TCP",
                      "address": "172.20.0.30",
                      "port_value": 50051
                    }
                  }
                }
              },
              {
                "endpoint": {
                  "address": {
                    "socket_address": {
                      "protocol": "TCP",
                      "address": "172.20.0.32",
                      "port_value": 50053
                    }
                  }
                }
              },
              {
                "endpoint": {
                  "address": {
                    "socket_address": {
                      "protocol": "TCP",
                      "address": "172.20.0.33",
                      "port_value": 50054
                    }
                  }
                }
              },
              {
                "endpoint": {
                  "address": {
                    "socket_address": {
                      "protocol": "TCP",
                      "address": "172.20.0.34",
                      "port_value": 50055
                    }
                  }
                }
              },
              {
                "endpoint": {
                  "address": {
                    "socket_address": {
                      "protocol": "TCP",
                      "address": "172.20.0.35",
                      "port_value": 50056
                    }
                  }
                }
              }
            ]
          }
        ]
      }
    }
  ]
}
